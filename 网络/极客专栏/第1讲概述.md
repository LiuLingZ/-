# 问题：当输入一个URL，如何找打服务器取得服务



HTTP处于应用层，应用层上包含了内容：我要买这个商品，买1件。

经过应用层封装后，应用层将数据包交由下层。

下层是传输层，有无连接的UDP和面向连接的TCP。面向连接，是指TCP保证包能到达目的地，失败就一直重发。

TCP协议有两个端口，一个是浏览器监听的端口，一个是服务器监听的端口，操作系统常通过端口判断，得到的包要给哪个进程 。接下来传给IP层。IP，是机器在互联网上的地址。通过IP知道是本地人还是外地人。

浏览器对应的主机对用 ip1 ； 浏览器通过DNS服务器获得 服务器所在ip2

显然，ip2不在本地网络中，在外网，那么ip1需要出网关

ip1 通过 APR 协议找到本地网络中 网关的位置ip3（ARP：通过MAC找到ip）

网关知道目的地在哪一个大致的位置，网关本身要存储这些信息，网关和网关之间常交流，存储一些地方该往哪走，这些沟通的协议就是路由协议，常用的路由协议：OSPF 和 BGP。





当数据包从网关传出，最后传到目的ip2的网关的时候，再通过ARP找到目的服务器

目的服务器拿到包，发现MAC地址对上了，就取下MAC头，交给上层网络层，网络层发现IP也对上了，拆下IP头，IP里写着是TCP协议，就交给TCP层。

TCP层中，对于收到的每个包，都会沿原路返回，回复一个包说明已经收到了（滑块控制），如果浏览器端没有收到回复包，则认为丢失，会重复发包。







# RPC框架作用

当网络包平安到达 TCP 层之后，TCP 头中有目标端口号，通过这个端口号，可以找到电商网站的进程正在监听这个端口号，假设一个 Tomcat，将这个包发给电商网站。﻿

电商网站的进程得到 HTTP 请求的内容，知道了要买东西，买多少。往往一个电商网站最初接待请求的这个 Tomcat 只是个接待员，负责统筹处理这个请求，而不是所有的事情都自己做。例如，这个接待员要告诉专门管理订单的进程，登记要买某个商品，买多少，要告诉管理库存的进程，库存要减少多少，要告诉支付的进程，应该付多少钱，等等。

如何告诉相关的进程呢？往往通过 RPC 调用，即远程过程调用的方式来实现。远程过程调用就是当告诉管理订单进程的时候，接待员不用关心中间的网络互连问题，会由 RPC 框架统一处理。RPC 框架有很多种，有基于 HTTP 协议放在 HTTP 的报文里面的，有直接封装在 TCP 报文里面的。

当接待员发现相应的部门都处理完毕，就回复一个 HTTPS 的包，告知下单成功。这个 HTTPS 的包，会像来的时候一样，经过千难万险到达你的个人电脑，最终进入浏览器，显示支付成功。



**到了传输层，往上提交时，提交到服务端监听的端口，可能是个Tomcat进程，负责处理统筹收到的请求，再通过RPC调用，传给负责专门处理此请求的进程。**

**Tomcat发现进程处理完毕后，就会通过原路，放回一个请求成功即相应的结果给客户端。**





