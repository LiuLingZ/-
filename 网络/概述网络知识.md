https://www.cnblogs.com/baizhanshi/p/8482612.html



在HTTP 1.0中，客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。

在HTTP 1.1中则可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。
  

由于HTTP在每次请求结束后都会主动释放连接，因此HTTP连接是一种“短连接”，要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。通常的 做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客 户端“在线”。若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。



 套接字（socket）是通信的基石，是支持TCP/IP协议的网络通信的基本操作单元。它是网络通信过程中端点的抽象表示，包含进行网络通信必须的五种信息：连接使用的协议，本地主机的IP地址，本地进程的协议端口，远地主机的IP地址，远地进程的协议端口。



SOCKET连接与TCP连接

​      创建Socket连接时，可以指定使用的传输层协议，Socket可以支持不同的传输层协议（TCP或UDP），当使用TCP协议进行连接时，该Socket连接就是一个TCP连接。


Socket连接与HTTP连接

​      由于通常情况下Socket连接就是TCP连接，因此Socket连接一旦建立，通信双方即可开始相互发送数据内容，直到双方连接断开。但在实际网络应用 中，客户端到服务器之间的通信往往需要穿越多个中间节点，例如路由器、网关、防火墙等，大部分防火墙默认会关闭长时间处于非活跃状态的连接而导 致 Socket 连接断连，因此需要通过轮询告诉网络，该连接处于活跃状态。

 	而HTTP连接使用的是“请求—响应”的方式，不仅在请求时需要先建立连接，而且需要客户端向服务器发出请求后，服务器端才能回复数据。

​      很多情况下，需要服务器端主动向客户端推送数据，保持客户端与服务器数据的实时与同步。此时若双方建立的是Socket连接，服务器就可以直接将数据传送给 客户端；若双方建立的是HTTP连接，则服务器需要等到客户端发送一次请求后才能将数据传回给客户端，因此，客户端定时向服务器端发送连接请求，不仅可以 保持在线，同时也是在“询问”服务器是否有新的数据，如果有就将数据传给客户端。





HTTP 与 TCP

```
HTTP： 
	为www服务，是应用层的协议，其存在是为了规定信息在网络上传输的格式的规定约束，保证通信双方能够正确解读。
TCP：
	作为传输层上的协议，本身是面向连接的全双工，提供可靠连接的传输层协议，其本职是提供通信双发的传输连接，以及保证能够正确传输信息到通讯双方。为上层协议提供无差别的数据传输服务。
```



OSI、TCP/IP 、 五层协议体系：

```
OSI七层协议 ： 应用层、表示层、会话层、传输层、网络层、数据链路层、物理层
TCP/IP四层协议 ： 应用层、传输层、网际层、网络接口层
五层协议：应用层、传输层、网络层、数据链路层、物理层
```



五层协议介绍：

```
应用层：
1、内容：	
	作为协议中最高层，其任务是应用进程间通过自己定义的协议进行规范交互。应用间定义了属	 于该应用的协议，用来规范数据传输的格式以及交互的规则。不同应用有不同协议。
2、常见协议：
	该层协议有万维网的HTTP协议、发送邮件时的STMP协议、域名解析用的DNS协议等。

传输层：
1、内容：
	为上层提供“无差别”的网络连接、传输数据的服务。为上层提供复用和分发功能。（无差别，	  复用传输过程；对不同的数据包分发给不同的应用功能。）
2、主要协议：
	TCP：
		Transmission Control Protocol,传输控制协议。提供面向连接的，可靠的数据传输		服务 。
	UDP：
		User Datagram Protocol，用户数据报协议，提供无连接的，尽最大努力交付的数据
		传输服务，不保证数据传输的可靠性。
		
网络层：
1、内容：
	负责为通信网上的不同主机提供通信服务。在网络层会把传输层产生的报文封装分组传输。
	在TCP/IP体系中，使用IP协议，所以分组也称IP数据报。
	网络层的另外一个重要的工作，就是在网络中定位到通信主机的位置，这个过程会经过大量路
	由寻找目的主机。
2、主要协议：
	IP
	
数据链路层：
1、内容：
	两台主机间的数据传输，总是在一段一段的链路上传输的，这就需要专门的链路层协议。数据链路层将网络层传下来的IP数据包组装成帧，在链路上传输的是 帧，每一帧都包含数据和必要的控制信息，如同步信息、地址信息、差错控制等。
	数据链路层要检错，错误的帧要抛弃重发。
	
物理层：
1、内容：
	实现相邻计算机节点间比特流的透明传送，尽可能屏蔽具体的传输介质和物理设备的差异，这里传输的仅仅只是一个个的比特，保证和物理介质无关。
	
	
```



UDP 和 TCP

```
UDP：
1、UDP是无连接的；
2、UDP使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态（这里面有	许多参数）；
3、UDP是面向报文的；
4、UDP没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低（对实时应用很有用，如IP	电话，实时视频会议等）；
5、UDP支持一对一、一对多、多对一和多对多的交互通信；
6、UDP的首部开销小，只有8个字节，比TCP的20个字节的首部要短。

TCP：
1、TCP是面向连接的。（就好像打电话一样，通话前需要先拨号建立连接，通话结束后要挂机释放	连接）；
2、每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的（一对一）；
3、TCP提供可靠交付的服务。通过TCP连接传送的数据，无差错、不丢失、不重复、并且按序到		达；
4、TCP提供全双工通信。TCP允许通信双方的应用进程在任何时候都能发送数据。TCP连接的两端都 	设有发送缓存和接收缓存，用来临时存放双方通信的数据；
5、面向字节流。TCP中的“流”（stream）指的是流入进程或从进程流出的字节序列。“面向字节  	 流”的含义是：虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程      序交下来的数据仅仅看成是一连串的无结构的字节流。

```





##TCP三次握手和四次挥手

###三次挥手

![img](https://mmbiz.qpic.cn/mmbiz_jpg/hvUCbRic69sAtXlEkwAAt66dnZ12LoziahYgdO8FWK4Xlv40icSAXLdE58bOtV3nf5LhxnKrHMhm3b4wvgkOaJqvg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

```
客户端–发送带有SYN标志的数据包–一次握手–服务端
服务端–发送带有SYN/ACK标志的数据包–二次握手–客户端
客户端–发送带有带有ACK标志的数据包–三次握手–服务端
```

#### 为什么是三次握手

​	**核心：通信双方必须确认自己与对方发送和接收都是正常的。确认自己正常，结果是得到对方的反馈；确认对方正常，结果是对方能根据自己发送的信息作出反馈。**

​	第一次握手：Client什么都不能确定，Server确定对方发送正常，自己接收正常。

​	第二次握手：Cilent确认自己发送、接收正常。对方发送、接收正常。

​	第三次握手：Server确认自己发送、接收正常。对方发送、接收正常。

​	**所以，三次过后，双方都能确定自己、对方是正常的，三次握手结束，开始通信。**

